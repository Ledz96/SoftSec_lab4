Type cast issue: width and height are 32 bit long, while img->size_x and img->size_y are only 16 bits long. As a consequence, as px is allocated as 16*16 bits at most, out of bounds access may happen if the 32 bits limits are checked, instead of the 16 bits boundaries. 
